<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Play Clesto, the Jungle Chess game online. A strategy board game with unique animal movements and rules.">
    <title>CLESTO: The Jungle Chess Game</title>

    <!-- Link External Stylesheet -->
    <link rel="stylesheet" href="style.css">

    <!-- Preload key visual assets -->
    <link rel="preload" as="image" href="https://staticjw.com/clesto/board.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/elephant-orange.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/elephant-yellow.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/lion-orange.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/lion-yellow.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/tiger-orange.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/tiger-yellow.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/leopard-orange.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/leopard-yellow.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/wolf-orange.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/wolf-yellow.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/dog-orange.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/dog-yellow.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/cat-orange.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/cat-yellow.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/rat-orange.png">
    <link rel="preload" as="image" href="https://staticjw.com/clesto/animals/rat-yellow.png">

</head>

<body>

    <h1>CLESTO: The Jungle Chess Game</h1>

    <main id="game-container" role="main">
        <!-- Game Board Section -->
        <section aria-labelledby="board-label">
            <h2 id="board-label" class="visually-hidden">Game Board</h2>
            <div id="board" tabindex="0">
                <div id="board-grid-wrapper">
                    <!-- Cells will be generated by JavaScript here -->
                </div>
            </div>
        </section>

        <!-- UI and Information Section -->
        <section id="ui-info-section" role="region" aria-labelledby="ui-info-heading">
            <h2 id="ui-info-heading">Game Info</h2>

            <!-- Clock Displays -->
            <div class="clock-container" id="orange-clock-container">
                <span class="clock-label">Orange Time:</span>
                <span class="clock-time" id="orange-clock-time">10:00</span>
            </div>
            <div class="clock-container" id="yellow-clock-container">
                <span class="clock-label">Yellow Time:</span>
                <span class="clock-time" id="yellow-clock-time">10:00</span>
            </div>

            <p>Turn: <span id="turn-indicator">Orange</span></p>
            <p>Status: <span id="status-message" aria-live="polite">Loading...</span></p>

            <!-- Player vs Player Toggle -->
            <div class="pvp-toggle-container">
                <label for="pvp-toggle" class="pvp-label">Player vs Player Mode:</label>
                <div class="switch-icon-wrapper">
                    <label class="switch">
                        <input type="checkbox" id="pvp-toggle">
                        <span class="slider round"></span>
                    </label>
                    <span class="pvp-info-icon" tabindex="0" role="button" aria-label="About Player vs Player Mode" aria-describedby="pvp-tooltip-content">â“˜</span>
                    <span class="tooltip-text" id="pvp-tooltip-content" role="tooltip">Two players take turns on the same device.</span>
                </div>
            </div>

            <!-- Audio Controls -->
            <div class="audio-controls-container">
                <div class="control-group music-control">
                    <span class="control-icon" aria-hidden="true">ðŸŽµ</span>
                    <label for="music-volume-slider" class="visually-hidden">Music Volume</label>
                    <input type="range" id="music-volume-slider" min="0" max="1" step="0.01" value="0.5" aria-label="Music Volume">
                    <span id="music-volume-display" class="volume-display">50%</span>
                </div>
                <div class="control-group sfx-control">
                    <span class="control-icon" aria-hidden="true">ðŸ”Š</span>
                    <label for="sfx-toggle" class="visually-hidden">Sound Effects</label>
                    <label class="switch sfx-switch">
                        <input type="checkbox" id="sfx-toggle" checked aria-label="Toggle Sound Effects">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>

            <!-- Game Buttons -->
            <div class="button-container">
                <button id="undo-button" class="game-button" disabled>Undo Turn</button>
                <button id="reset-button" class="game-button">Reset Game</button>
            </div>

            <!-- Move Log -->
            <h3>Move Log</h3>
            <button id="copy-log-button" class="copy-button" title="Copy move log to clipboard">Copy Log ðŸ“‹</button>
            <div id="move-log" class="scrollable-log" aria-live="polite"></div>

            <!-- Board State -->
            <h3>Board State</h3>
            <button id="copy-state-button" class="copy-button" title="Copy board state hash to clipboard">Copy Board State ðŸ“‹</button>
            <div id="board-state-log"></div>

            <!-- Load From State Section -->
            <div class="load-state-container">
                <label for="board-state-input">Load Board State:</label>
                <input type="text" id="board-state-input" placeholder="Paste board state hash...">
                <button id="load-state-button" class="game-button">Load</button>
                <p id="load-status-message" class="load-status"></p>
            </div>
        </section>
    </main>

    <!-- Rules Accordion Section -->
    <section id="rules-accordion-container" aria-labelledby="rules-heading">
        <button id="rules-toggle-button" class="rules-toggle-button" aria-expanded="false" aria-controls="rules-content">
            <span class="rules-button-text">Show Game Rules</span>
            <span class="rules-icon" aria-hidden="true">+</span>
        </button>
        <div id="rules-content" class="rules-content" role="region" aria-hidden="true">
            <h2 id="rules-heading" class="visually-hidden">Game Rules</h2>
            <!-- Rules content remains the same -->
            <h3>Objective</h3>
            <p>Be the first player to move any of your animals into the opponent's <strong>Den</strong> square.</p>
            <ul><li>Orange's Den: <strong>d1</strong></li><li>Yellow's Den: <strong>d9</strong></li></ul>
            <h3>Gameplay</h3>
            <ul><li>Orange starts the game.</li><li>Players take turns moving one animal per turn.</li><li>Animals move one square horizontally or vertically (never diagonally).</li><li>You cannot move onto a square occupied by your own animal.</li></ul>
            <h4>Attacking</h4>
            <ul><li>You can move onto a square occupied by an opponent's animal if your animal's rank is <strong>equal to or higher than</strong> the opponent's rank.</li><li>This is an attack, and the opponent's captured animal is removed from the board.</li><li><strong>Exception:</strong> See Special Powers for Rat vs. Elephant.</li></ul>
            <h4>End of Turn Sequence</h4>
            <p>After making your move, the following checks happen automatically:</p>
            <ol><li><strong>Declare Hungry:</strong> Any of the <em>opponent's</em> animals that can now make a valid attack are marked as <strong>hungry</strong> (red glow).</li><li><strong>Check Starvation:</strong> If any of <em>your own</em> animals were marked as hungry at the <em>start</em> of your turn, but you did not make an attacking move with any of them, those hungry animals starve and are removed from the board.</li></ol>
            <h4>Special Squares</h4>
            <ul><li><strong>Den:</strong> Your own Den (Orange: d1, Yellow: d9) cannot be entered by your pieces. Reaching the opponent's Den wins the game. A <strong>hungry</strong> animal cannot enter the opponent's Den.</li><li><strong>Water (b4-c6, e4-f6):</strong> Only specific animals can enter or move on water (see Special Powers).</li><li><strong>Traps:</strong><ul><li>Orange Traps: <strong>c1, d2, e1</strong></li><li>Yellow Traps: <strong>c9, d8, e9</strong></li></ul> Any animal landing on a Trap square has its rank effectively reduced to <strong>0</strong> for the purpose of being attacked while on that square. A "(0)" marker appears above trapped animals. However, an animal attacking <em>from</em> a trap square uses its normal rank.</li></ul>
            <h4>Other Rules</h4>
            <ul><li>You must make a move each turn (passing is not allowed).</li></ul>
            <h3>Special Powers</h3>
            <ul><li><strong>Rat [1]:</strong><ul><li>Can enter, move on, and <strong>attack from Water</strong> squares.</li><li>Can attack the <strong>Elephant [8]</strong>, but only when attacking from a land square (cannot attack Elephant when starting from Water).</li></ul></li><li><strong>Dog [3]:</strong><ul><li>Can enter, move on, and <strong>attack from Water</strong> squares.</li></ul></li><li><strong>Lion [7] and Tiger [6]:</strong><ul><li>Can <strong>jump</strong> horizontally or vertically over <strong>Water</strong> squares.</li><li>A jump moves from a land square directly across 2 or 3 water squares to another land square.</li><li>Jumps can be used to move or attack.</li><li>A jump is blocked if an opponent's swimming animal (Rat or Dog) occupies any water square along the jump path.</li></ul></li><li><strong>Leopard [5]:</strong><ul><li>Can <strong>jump horizontally</strong> over <strong>Water</strong> squares (across 2 water squares).</li><li>Cannot jump vertically.</li><li>Jumps follow the same blocking rules as Lion/Tiger.</li></ul></li><li><strong>Elephant [8]:</strong> Can attack the Rat [1].</li></ul>
            <h3>Repetition Limit</h3>
            <p>To prevent endless loops and ensure a winner, a repetition rule exists:</p>
            <ul><li>Determine which player currently has more animals on the board. If tied, the starting player (Orange) is considered the "leading player".</li><li>The leading player is <strong>not allowed</strong> to make a move that results in a board position that has already occurred <strong>3 times</strong> previously during the game.</li></ul>
            <p><em>(Board positions are tracked automatically.)</em></p>
        </div>
    </section>

    <!-- Debug Log Section (conditionally displayed) -->
    <section id="debug-log-container" class="debug-hidden" aria-labelledby="debug-log-heading">
        <h2 id="debug-log-heading">Debug Log</h2>
        <div id="debug-log-output"></div>
        <button id="clear-debug-log" class="game-button">Clear Log</button>
    </section>

    <!-- Hidden container for preloading/caching piece image assets -->
    <div id="piece-assets" style="display: none;">
        <img data-piece="O_8" src="https://staticjw.com/clesto/animals/elephant-orange.png" alt="" loading="lazy"><img data-piece="O_7" src="https://staticjw.com/clesto/animals/lion-orange.png" alt="" loading="lazy"><img data-piece="O_6" src="https://staticjw.com/clesto/animals/tiger-orange.png" alt="" loading="lazy"><img data-piece="O_5" src="https://staticjw.com/clesto/animals/leopard-orange.png" alt="" loading="lazy"><img data-piece="O_4" src="https://staticjw.com/clesto/animals/wolf-orange.png" alt="" loading="lazy"><img data-piece="O_3" src="https://staticjw.com/clesto/animals/dog-orange.png" alt="" loading="lazy"><img data-piece="O_2" src="https://staticjw.com/clesto/animals/cat-orange.png" alt="" loading="lazy"><img data-piece="O_1" src="https://staticjw.com/clesto/animals/rat-orange.png" alt="" loading="lazy"><img data-piece="Y_8" src="https://staticjw.com/clesto/animals/elephant-yellow.png" alt="" loading="lazy"><img data-piece="Y_7" src="https://staticjw.com/clesto/animals/lion-yellow.png" alt="" loading="lazy"><img data-piece="Y_6" src="https://staticjw.com/clesto/animals/tiger-yellow.png" alt="" loading="lazy"><img data-piece="Y_5" src="https://staticjw.com/clesto/animals/leopard-yellow.png" alt="" loading="lazy"><img data-piece="Y_4" src="https://staticjw.com/clesto/animals/wolf-yellow.png" alt="" loading="lazy"><img data-piece="Y_3" src="https://staticjw.com/clesto/animals/dog-yellow.png" alt="" loading="lazy"><img data-piece="Y_2" src="https://staticjw.com/clesto/animals/cat-yellow.png" alt="" loading="lazy"><img data-piece="Y_1" src="https://staticjw.com/clesto/animals/rat-yellow.png" alt="" loading="lazy">
    </div>

    <!-- Shared Tooltip for Move Log -->
    <span id="move-log-tooltip" class="shared-tooltip" role="tooltip" aria-hidden="true"></span>

    <!-- Audio Elements -->
    <audio id="turn-start-sound" src="https://staticjw.com/clesto/play/notification-alert.mp3" preload="auto"></audio>
    <audio id="capture-sound" src="https://staticjw.com/clesto/play/capture.mp3" preload="auto"></audio>
    <audio id="error-sound" src="https://staticjw.com/clesto/play/error.mp3" preload="auto"></audio>
    <audio id="hungry-warning-sound" src="https://staticjw.com/clesto/play/hungry-warning.mp3" preload="auto"></audio>
    <audio id="undo-sound" src="https://staticjw.com/clesto/play/undo-move.mp3" preload="auto"></audio>
    <audio id="win-sound" src="https://staticjw.com/clesto/play/win.mp3" preload="auto"></audio>
    <audio id="background-music" src="https://staticjw.com/clesto/play/background-music.mp3" preload="auto" loop></audio>

    <!-- Include JavaScript Files (Order Matters!) -->
    <script src="constants.js"></script>
    <script src="utils.js"></script>
    <script src="bitboardUtils.js"></script>
    <script src="gameState.js"></script>
    <script src="gameLogic.js"></script>
    <script src="ai.js"></script>
    <script src="audio.js"></script>
    <script src="debug.js"></script>
    <script src="ui.js"></script>
    <script src="main.js"></script> <!-- Main entry point must be last -->

</body>
</html>